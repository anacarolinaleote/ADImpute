---
title: "ADImpute_tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ADImpute_tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
is_check <- ("CheckExEnv" %in% search()) || any(c("_R_CHECK_TIMINGS_",
             "_R_CHECK_LICENSE_") %in% names(Sys.getenv()))
knitr::opts_chunk$set(eval = !is_check, collapse = TRUE, comment = "#>")
```

```{r setup}
library(ADImpute)
```

For time and memory management reasons, this demo uses a subset of the Grun pancreas dataset. When using the ADImpute package, please run on the full datasets (no subsetting for genes), as the gene regulatory model employed uses expression information from all genes in the data.
```{r}
RPM <- NormalizeRPM(ADImpute::demo_data) # normalize for library size
```

Evaluate methods to determine the best performing imputation method for each gene. This step sets a fraction of the quantified entries in the input data to zero, applies different normalization methods to the data and compares the imputation results to the original values. This allows ADImpute to determine which method imputes values with the lowest errors for each gene.
```{r, warning=FALSE}
set.seed(1)
methods_pergene <- EvaluateMethods(data = RPM,
                                   do = c("Baseline", "DrImpute",
                                          "Network"), # these are the default
                                                      # methods to test. Exclude
                                                      # any of them by removing
                                                      # them from the vector
                                   training.ratio = .7,
                                   mask.ratio = .2,
                                   cores = 2,
                                   network.coefficients = ADImpute::demo_net)
head(methods_pergene) # show the best performing method for the first 6 genes
```

After determining which method performs best for each gene, ADImpute redoes the imputation on the original data and combines the results of different methods into an ensemble.
```{r, warning=FALSE}
imputed <- Impute(do = "Ensemble",
                  method.choice = methods_pergene,
                  data = RPM,
                  cores = 2,
                  network.coefficients = ADImpute::demo_net)
str(imputed)
```

